<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Подтверждение заказа №{{ order.id }}</title>
</head>
<body style="margin:0;padding:0;font-family:Arial,sans-serif;background:#f4f4f4;">
  <table role="presentation" width="100%" cellpadding="0" cellspacing="0"
         style="background:#f4f4f4;padding:20px;">
    <tr>
      <td align="center">
        <table role="presentation" width="600" cellpadding="0" cellspacing="0"
               style="background:#ffffff;border-radius:8px;overflow:hidden;">

          <!-- HEADER -->
          <tr>
            <td style="background:#28a745;padding:30px;text-align:center;">
              <h1 style="color:#ffffff;margin:0;font-size:24px;">
                Ваш заказ №{{ order.id }} принят!
              </h1>
            </td>
          </tr>

          <!-- BODY -->
          <tr>
            <td style="padding:30px;color:#333333;">

              <!-- Приветствие -->
              <p style="font-size:16px;line-height:1.5;margin-bottom:20px;">
                Привет, <strong>{{ order.delivery_contact.first_name }}</strong>!
              </p>

              <!-- Статус заказа -->
              <p style="font-size:16px;line-height:1.5;margin-bottom:20px;">
                Ваш заказ №{{ order.id }} успешно принят.
              </p>

              <!-- Контактная информация -->
              <p style="font-size:16px;line-height:1.5;margin-bottom:10px;">
                <strong>Контактная информация:</strong>
              </p>
              <p style="font-size:14px;line-height:1.4;margin-bottom:20px;">
                Email: <a href="mailto:{{ order.delivery_contact.email }}"
                         style="color:#28a745;text-decoration:none;">
                         {{ order.delivery_contact.email }}
                       </a><br>
                Телефон: {{ order.delivery_contact.phone }}
              </p>

                <!-- Состав заказа -->
              <p style="font-size:16px;line-height:1.5;margin-bottom:10px;">
                <strong>Состав заказа:</strong>
              </p>
              <table role="presentation" width="100%" cellpadding="0" cellspacing="0"
                     style="table-layout:fixed;border-collapse:collapse;
                            font-size:16px;line-height:1.5;margin-bottom:20px;">
                <thead>
                  <tr>
                    <th align="left"   style="border-bottom:2px solid #eee;
                                            padding:8px;width:35%;">Товар</th>
                    <th align="left"   style="border-bottom:2px solid #eee;
                                            padding:8px;width:20%;">Магазин</th>
                    <th align="center" style="border-bottom:2px solid #eee;
                                            padding:8px;width:15%;">Кол‑во</th>
                    <th align="right"  style="border-bottom:2px solid #eee;
                                            padding:8px;width:15%;">Цена шт.</th>
                    <th align="right"  style="border-bottom:2px solid #eee;
                                            padding:8px;width:15%;">Сумма</th>
                  </tr>
                </thead>
                <tbody>
                  {% for shop_order in order.shop_orders.all %}
                    {% for item in shop_order.items.all %}
                    <tr>
                      <td style="padding:8px;border-bottom:1px solid #eee;
                                 word-break:break-word;white-space:normal;">
                        {{ item.product.name }}
                      </td>
                      <td style="padding:8px;border-bottom:1px solid #eee;">
                        {{ shop_order.shop.name }}
                      </td>
                      <td align="center" style="padding:8px;border-bottom:1px solid #eee;">
                        {{ item.quantity }}
                      </td>
                      <td align="right" style="padding:8px;border-bottom:1px solid #eee;">
                        {{ item.unit_price }} ₽
                      </td>
                      <td align="right" style="padding:8px;border-bottom:1px solid #eee;">
                        {{ item.get_total_price }} ₽
                      </td>
                    </tr>
                    {% endfor %}
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="4" align="right"
                        style="padding:12px;border-top:2px solid #ddd;font-weight:bold;">
                      Итого к оплате:
                    </td>
                    <td align="right"
                        style="padding:12px;border-top:2px solid #ddd;font-weight:bold;">
                      {{ order.total_amount }} ₽
                    </td>
                  </tr>
                </tfoot>
              </table>


              <!-- Адрес доставки -->
              <p style="font-size:16px;line-height:1.5;margin-bottom:20px;">
                <strong>Адрес доставки:</strong><br>
                {{ order.delivery_contact.city }}, ул. {{ order.delivery_contact.street }}, д. {{ order.delivery_contact.house }}
                {% if order.delivery_contact.building %}, корп. {{ order.delivery_contact.building }}{% endif %}
                {% if order.delivery_contact.apartment %}, кв. {{ order.delivery_contact.apartment }}{% endif %}
              </p>

              <!-- Кнопка перехода -->
              <p style="text-align:center;margin:30px 0;">
                <a href="http://localhost:8000/api/orders/{{ order.id }}"
                   style="background:#28a745;
                          color:#ffffff;
                          padding:12px 20px;
                          text-decoration:none;
                          border-radius:4px;
                          display:inline-block;">
                  Посмотреть мой заказ
                </a>
              </p>

              <!-- Подпись -->
              <p style="font-size:14px;color:#777777;line-height:1.4;">
                Если у вас возникнут вопросы — просто ответьте на это письмо.
              </p>
              <p style="font-size:14px;color:#777777;line-height:1.4;">
                С уважением,<br>
                Команда Сервиса Автоматизации Закупок
              </p>

            </td>
          </tr>

          <!-- FOOTER -->
          <tr>
            <td style="background:#f0f0f0;padding:20px;text-align:center;
                       font-size:12px;color:#888888;">
              © 2025 Сервис Автоматизации Закупок. Все права защищены.
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>
